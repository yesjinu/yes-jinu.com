---
title: 데이터베이스 개론과 실습 part 2 (2/3)
date: 2021-07-20 23:07:04
category: dev
thumbnail: { thumbnailSrc }
draft: false
---

쿼리를 작성하는 부분은 데이터베이스의 인터페이스를 조작하는 일이다. '데이터베이스 내부 사정은 모르겠고, 이런이런 값이 필요하니 가져다다오'랄까.  모듈화된 프로그램을 이용할 때 대부분의 경우, 내부 구조를 몰라도 상관이 없어야 한다. 속도감, 효능감을 위해 내부 분석을 전략적으로 스킵하는 것도 방법이다. 하지만 자신의 주무기가 되어야 하는 툴이라면, 내부를 한 단계 더 들여다보는 편이 좋을 것이다. 주무기를 자유롭게 사용할 수 있는 상태가 고수가 아닐까.. ~~하는 초심자의 추측~~

지난 ch2 (1/3)에서 실제적인 쿼리를 작성하는 법에 대해 배웠다면 후반부에서는 조금 더 개념적인 부분을 다룬다. 가상 테이블 뷰(view)와 인덱스(index)가 그것이다. 책을 중심으로, 인터넷을 통해 찾은 자료를 덧붙여 정리해보고자 한다.

## 뷰 View
### 필요성
서점을 운영한다고 하자. 서점의 매출 정보나 고객의 취향을 분석하기 위해서는 다양한 보고서를 만들 필요가 있다. 예컨대, 일별 매출 정보, 고객별 판매내역 등의 테이블이 필요할 것이다. 이런 정보들은 하나의 테이블에 집중되어 있는 것이 아닌, 여러 테이블을 혼합해 만들어야 한다. Business insight 라는 것은 하나의 테이블로 뚝딱 유추해낼 수 있을만큼 쉽게 얻어지는 것이 아니다..

그럼에도 불구하고 대체로 정해진 조합이라는 것이 있을 것이다. 예를 들어 판매 정보가 담긴 order 테이블과, 고객 정보가 담긴 customer 테이블, 책 정보가 담긴 book 테이블은 서로 `join` or `sub-querying`되어 사용되는 경우가 많을 것인데, 매번 작업할 때마다 이 커맨드를 입력하는 것은 매우 번거로운 일이 될 것이다. '이 조합으로 만들어진 테이블이 있다면 얼마나 좋을까?'의 화답으로 만들어진 것이 뷰(view)다.

### 뷰(View)란
뷰(View)는 하나 이상의 테이블을 합하여 만든 가상 테이블로, 실제 테이블처럼 사용할 수 있다. 신기하게도 뷰는 디스크에 테이블 데이터를 따로 저장하지 않는데, 이는 뷰를 생성할 때 사용한 `SELECT`문의 정의를 DBMD가 저장하고 있다가, 쿼리를 처리할 때 이를 참조해 사용하기 때문이다. 즉, 유저가 뷰에 쿼리를 날리면 DBMS는 뷰의 정의를 참조해 쿼리를 수행하고, 그 결과를 반환한다. 유저는 뷰의 정의를 알지 못해도, 마치 그런 '테이블'이 존재하는 것처럼 사용할 수 있다. ~~(혁명!)~~

하지만 뷰에도 몇 가지 제약사항이 있는데, 테이블의 정보를 조작하는 DML 쿼리의 경우 '경우에 따라' 수행되지 않는다 예를 들어, `UPDATE` 키워드를 사용해 특정 속성을 업데이트할 때, 기본키를 포함하지 않는 수정 요청인 경우 수행되지 않는다. 또, 2개 이상의 base table(조합에 사용된 테이블)의 속성을 포함하는 수정 요청 역시 금지된다. 이 경우 `PLAN`을 이용해 쿼리를 실행해보고, 문제가 있는 쿼리인 경우 실행하지 않는 방향으로 구현되지 않은 것이 의아했다. 🤔

### 커맨드
1. 생성
```sql
CREATE VIEW 이름 [(열1, 열2, ...)]
AS SELECT 문
```
여기에서 '이름'은 뷰의 이름이고, '열1, 열2, ...'는 SELECT에서 추출하는 속성과 일대일 대응해야 한다. 예를 들어서 설명해보자.
```sql
CREATE VIEW V_Book_Soccer (name, id, price)
AS SELECT name, id, price
	 FROM Book
   WHERE bookname LIKE '%축구%'
```
이 쿼리를 수행하면 `V_Book_Soccer`라는 가상의 테이블이 만들어지고, 이를 일반 테이블처럼 사용할 수 있다. Base table인 `Book` 테이블에 새로운 '%축구%' 튜플이 추가된다면, 이 데이터는 `V_Book_Soccer`에서도 조회 가능하다. 
2. 수정
테이블의 스키마를 수정하는 것처럼, 필요한 경우 뷰 스키마 역시 수정 가능하다.
```sql
CREATE **OR REPLACE** VIEW 이름 [(열1, 열2, ...)]
AS SELECT 문
```
3. 삭제
테이블 삭제와 마찬가지로 `DROP` 키워드를 통해 뷰를 삭제할 수 있다.
```sql
DROP VIEW 이름
```
