---
title: 데이터베이스 개론과 실습 part 2 (3/3)
date: 2021-07-20 23:07:04
category: dev
thumbnail: { thumbnailSrc }
draft: false
---

# Database ch 2 (3/3) 
이번 포스팅에서는 인덱스(Index)에 대해 다루려 한다. 그에 앞서, DBMS에 저장한 데이터는 물리적으로 어디에, 어떻게 저장될까? 일단 물리적으로 데이터가 '디스크'에 저장되는 것은 자명해보인다. 데이터는 디스크 혹은 메모리에 저장될텐데, 전원 공급이 중단되면 데이터가 유실되는 메모리보다는 디스크에 저장하는 편이 더 안정적일 것이다. 

우리가 워드 파일을 `.docx` 라는 특수한 확장자를 가진 파일에 저장하는 것처럼, DBMS 역시 고유한 포맷으로 데이터를 저장/관리한다. 저장장치 엔진에 따라 데이터를 저장하는 방법에 차이가 있는데, innoDB의 경우 테이블의 형태(`frm file`)와 내용물(`ibdata`)을 별도의 파일로 분리해 저장한다. DBMS의 저장장치 엔진은 플러그인 방식으로 여러 종류 중에 선택할 수 있으며, MySQL은 InnoDB 엔진이 디폴트로 설치되어 있다. 

### 인덱스와 B-tree
책 뒤쪽에 위치하는 '찾아보기'가 바로 인덱스다. 한국의 역사를 다루는 책에서 '안창호'라는 단어가 등장하는 페이지를 찾고 싶다고 하자. 키워드와 페이지가 페어링돼 적혀있는 '찾아보기' 페이지가 없다면, 우리는 책의 첫 장부터 '안창호'라는 이름을 찾아야할 것이다. 하지만 '찾아보기'가 있기 때문에 원하는 페이지에 바로 찾아갈 수 있다. (`안창호 - 90p, 105p, 120p`)

인덱스는 원하는 정보를 빠르게 찾을 수 있도록 고안된 데이터 구조다. 예시로 든 '찾아보기'에 키워드와 페이지가 함께 저장되어 있던 것과 같이, 인덱스에는 튜플의 키 값에 대한 디스크 물리적 위치가 기록되어 있다. 

일반적으로 인덱스는 B-tree 구조로 구현되어 있는데, B-tree는 binary tree(2-children)의 generalize된 버전(n-children)이라고 생각하면 된다. B-tree는 정렬된 데이터를 트리구조로 연결해 현재값과 찾는 값 사이의 크기 비교만으로 빠르게 후보군을 좁혀나간다. B-tree의 각 노드는 키 값과 포인터를 가지는데, 키 값의 좌우에 위치한 포인터는 각각 키 값보다 작은 값과 큰 값을 가진 다음 노드를 가리킨다. 

**장점** : 검색이 매우 빠름. 100만 개의 튜플을 가진 데이터도 3-4번의 디스크 블록 비교를 통해 검색 가능 
**단점** : B-tree의 특성상 balance를 유지하기 위해 노드의 분할 및 이동이 자주 발생. 잦은 데이터 변경/추가 시 효율 떨어짐

### 클러스터 인덱스 vs. 넌클러스터 인덱스
**클러스터 인덱스**
국어사전이 ㄱ부터 ㅎ 순서로 정렬되어 있듯이, 클러스터 인덱스는 기본키(PK)를 기준으로 테이블을 정렬(sorting)한다. 테이블 당 1개의 클러스터 인덱스만 허용되고, 별도의 저장공간에 '인덱스 페이지'를 저장하는 등의 overhead가 필요하지 않다. 데이터가 입력, 수정, 삭제되어도 항상 정렬을 유지하기 때문에, DML 작업이 많은 테이블의 경우 성능이 떨어질 수 있다.

**넌클러스터 인덱스**
책 뒷편의 '찾아보기'와 같이 별도의 '인덱스 페이지'를 만들어 저장하는 식이다. 테이블 당 최대 249개까지 생성 가능하고, 테이블 자체는 정렬되지 않고, 인덱스 페이지만 정렬해 유지한다. 인덱스 페이지만 정렬을 유지하기 때문에 DML 작업으로 인한 성능 저하 이슈는 없는 편.

### In Action
예를 들어, 아래와 같이 범위를 탐색하는 쿼리를 수행한다고 하자. 
```sql
SELECT YEAR(publish_date), COUNT(*)
FROM books
WHERE publish_date >= '2000-01-01'
GROUP BY YEAR(publish_date)
```
이 경우 `publish_date`에 클러스터 인덱스를 부여하면 비약적인 성능 향상이 가능하다. 테이블이 `publish_date`를 기준으로 정렬될 것이기 때문이다. 
